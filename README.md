# oscilloscope_logging

オシロスコープのデータをリアルタイムで取得するプログラムです．<br><br>

## 初めに

オシロスコープとPCの接続はUSBを想定しています．<br>
このとき，計測機器との通信にはVISA通信を用いますが，**専用のドライバ**が必要になります．<br>
各社・各団体から色々なドライバが出ていますが，こだわりがなければフリーの[NI-VISA](https://www.ni.com/ja/support/downloads/drivers/download.ni-visa.html)を使うのを推奨します．<br><br>

また，このプログラムはPythonで書かれており．パッケージマネージャ: `uv`を使うのを想定しています．<br>
この場合，以下のコマンドで依存関係 (ライブラリ) のセットアップが完了します．
```[shell]
 uv sync
```
`uv`の環境がない場合は，適宜`pip`コマンドなどで(仮想)環境を整えてください (Google Colabolatoryなどのweb上では動かないと思います).<br>
必要なライブラリは以下の通りです．

- `pyqtgraph` (リアルタイムグラフ描画)
- `pyqt6` (`pyqtgraph`のバックエンドのようなもの. GUI系)
- `pyvisa` (VISA通信)

## 使い方
1. オシロとの通信の確認<br>
`test.py`は通信確認用のコードです．<br>
ドライバがない・うまく計測機器を認識していない等あればエラーが表示されます．<br>
`uv`では以下のコマンドで実行します
```[shell]
  uv run .\test.py   
```
`uv`を使っていない場合は基本以下のコマンドで実行できます．
```[shell]
  python .\test.py
```
実行すると，リソースを識別するアドレスが表示されるので，値をコピーしてください．<br>
`oscillo.py`の105行目`RESOURCE`変数の値をコピーした値に変更します．

2. メインプログラムの実行
`oscillo.py`がメインのコードです．
以下のコマンドで実行します．
```[shell]
  uv run .\oscillo.py
```
`uv`を使っていない場合は，
```[shell]
  python .\oscillo.py
```
値の保存先は`CSV_FILE`変数の値を変えて変更してください．<br>
また，データの更新 (=グラフの表示) 間隔は`OscilloAvgPlot`クラスのインスタンスの引数 (107行目) である`interval_ms` で変更できます．<br>
ただし，グラフの描画も併せて行うことや，Python独自のスピードの問題もあり，その間隔で実行されることは保証されません．<br>
なお，このプログラムでは，指定された間隔毎にオシロスコープから現在画面に映っている分の波形を取得し，平均を取ることで現在の値としています．<br>
ですので，オシロスコープの時間幅は細かく設定しておいてください．

